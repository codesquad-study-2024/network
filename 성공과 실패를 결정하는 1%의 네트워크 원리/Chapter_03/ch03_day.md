### Story 2. 스위칭 허브의 패킷 중계 동작
#### 스위칭 허브는 주소 테이블로 중계한다
스위칭 허브는 이더넷 내부에서 패킷을 전달한다.

최근에는 리피터 허브를 따로 사용하지 않고, 스위칭 허브를 바로 사용하는 경우가 많다. (책에서는 리피터 허브를 통해 스위치 허브로 연결되는 것을 가정하고 설명)

<img width="893" alt="스크린샷 2024-08-07 오후 1 19 55" src="https://github.com/user-attachments/assets/7e4f7b7b-5b4b-4b8b-8e65-38bbda388da3">

전기 신호가 들어와서 변환과 검사를 거친 뒤 버퍼 메모리에 저장되는 과정은 LAN 어댑터에서의 과정과 유사하다.

이러한 과정을 담당하는 회로 부분을 스위칭 허브에서는 `포트`라고 한다.  
이 포트들에는 MAC 주소가 할당되어 있지 않다. 따라서 LAN 어댑터와 다르게 패킷을 수신할 때 MAC 주소를 검사하지 않고 모든 패킷을 수신하여 저장해둔다는 차이점이 있다.

패킷의 내용을 버퍼 메모리에 담는 부분까지 끝났다면, 수신처의 MAC 주소와 일치하는 내용을 MAC 주소 테이블에서 찾는다. 그래서 어떤 포트로 해당 패킷을 보내주면 좋을지를 판단하게 됨
이 때, `스위치 회로`라는 구조를 경유하여 포트로 패킷을 보낸다. 여러 개의 스위치로 이루어져 있는 이 회로는, 각각 독립하여 움직이는 회로를 모아서 사용하는 개념이기 때문에 신호가 중복되지 않는다면 동시에 신호를 주는 것도 가능.

이렇게 패킷 데이터를 받게 된 포트는 다시 반대 방향으로 데이터를 전기 신호로 변환한 후에 내보내게 된다. (아래 예시는 반이중 방식의 경우)
1. 수신 회로에 신호가 없는 것을 확인 (즉 아무도 송신중이지 않음을 확인)
2. 만일 누군가 송신중일 경우, 끝날 때 까지 기다렸다가 수신
3. 송신 동작 중 다른 기기가 신호를 보낼 경우 충돌이기 때문에 재밍 신호를 보냄

#### MAC 주소 테이블을 등록 및 갱신
- 패킷을 수신했을 때, 송신처 MAC 주소를 조사하고, 수신한 입력 포트 번호와 함께 MAC 주소표에 등록  &rarr; MAC 주소와 해당 MAC 주소를 가진 기기가 어디 포트에 존재하는지가 짝지어져 있다고 생각하자
- 기기들이 이동하는 경우의 불편함을 방지하기 위해 일정 시간이 지나면 해당 정보가 지워지도록 설정되어 있다.

#### 예외적인 동작
- 송신 포트와 수신 포트가 같은 경우 &rarr; 같은 패킷이 같은 송신처에 두 번 도착하게 되므로, 이럴 경우 패킷을 중계하지 않고 폐기
- MAC 주소 테이블에 찾고자 하는 주소가 존재하지 않는 경우 &rarr; flooding. 패킷을 보낸 기기를 제외한 모든 기기에게 패킷을 송신한다.

#### 전이중 모드에서 송신과 수신을 동시에 실행한다
송신과 수신을 동시에 실행할 수 있는 전이중 모드는 스위칭 허브에서만 가능하다. 리피터 허브에서는 이렇게 동시에 실행이 이루어지면 신호가 뒤섞여 문제가 된다.

원래 송 수신 부분 사이에는 서로의 신호를 조사하여 충돌 여부를 확인하는 부분이 있는데, 전이중 모드에서는 이 신호의 충돌을 검출하는 부분을 무효화시킨다.  
따라서 송신 시 신호가 이미 흐르고 있어도 수신할 수 있으며 그 반대 또한 마찬가지이다.

#### 최적의 전송 속도로 보내는 자동 조정
접속한 상대가 전이중 모드를 지원하는지, 속도는 어떠한지를 검출하고 동작 모드나 전송 속도를 자동으로 맞춰 주는 기능이다.

서로 펄스 신호가 규칙적으로 흐르는 상황에서 연결이 시작되면 나타나는 신호를 판별하여 서로 어느 모드를 지원하는지 확인하게 된다. 이 때 모드를 선택하는 우선 순위가 정해져 있어 이 순위대로 확인한다.  
이렇게 최적의 조합을 찾아 모드를 맞추게 되는 것이다.

#### 스위칭 허브는 복수의 중계 동작을 동시에 실행한다
한 포트에서 송신 동작을 실행할 때, 동시에 다른 포트에서도 별도의 패킷을 처리할 수 있다.
이렇게 충돌에 신경쓰지 않기 때문에 리피터 허브보다 많은 양의 패킷을 중계할 수 있게 된다.

<img width="1156" alt="스크린샷 2024-08-07 오후 2 18 49" src="https://github.com/user-attachments/assets/ea647907-7f16-4d45-903a-f9303b955b57">
