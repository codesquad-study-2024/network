## story 5. 콘텐츠 배포 서비스
### 1. 콘텐츠 배포 서비스를 이용한 부하 분산
> 캐시 서버를 클라이언트 측에 두기 vs 캐시 서버를 서버 측에 두기

<img width="1145" alt="스크린샷 2024-08-14 오전 12 10 26" src="https://github.com/user-attachments/assets/6af1b1ce-67e0-4205-8319-8aaaa337ac91">

<img width="1185" alt="스크린샷 2024-08-14 오전 12 12 10" src="https://github.com/user-attachments/assets/8b0dec28-298a-4c43-9073-ec3c85605da6">

<img width="1268" alt="스크린샷 2024-08-14 오전 12 12 26" src="https://github.com/user-attachments/assets/1dff1c66-5b7e-4eda-b318-98b6bcf4e932">

<img width="1199" alt="스크린샷 2024-08-14 오전 12 18 11" src="https://github.com/user-attachments/assets/22497fbf-a401-4ccc-b319-74c18452c80d">

### 2. 가장 가까운 캐시 서버의 관점
이렇게 콘텐츠 배포 서비스를 이용하는 경우 여러 프로바이더에 캐시 서버가 다수 설치되어 있기 때문에, `어떻게 가까운 캐시 서버와 응답을 주고받게 할 것인가?`가 중점이다.  
포워드 프록시처럼 모든 클라이언트에 프록시 서버를 등록하여 가까운 캐시 서버를 기록하면 좋겠지만, 현실적으로는 불가능하다. 그렇다면 어떤 방법이 있을까?

#### DNS 서버에서 IP 주소를 회답할 때, 가장 가까운 캐시 서버의 주소를 알려주도록 설정한다.
<img width="1105" alt="스크린샷 2024-08-14 오전 12 42 11" src="https://github.com/user-attachments/assets/be22ffec-1497-4353-b0bb-6f8f3a721dc8">

### 3. 리피터용 서비스로 엑세스 대상을 분배한다.
가까운 캐시 서버에 엑세스하는 또 다른 방법이 있다. 바로 http 메세지의 `Location`헤더와 `리다이렉트`를 이용하는 방법이다.
<img width="1030" alt="스크린샷 2024-08-14 오전 12 51 03" src="https://github.com/user-attachments/assets/ec60e764-72ed-423b-88c6-33ff9353dfed">

이렇게 리다이렉트 되는 경우, 실제 송신처 IP 주소를 대상으로 거리계산을 하기 때문에, DNS 서버의 위치를 가지고 계산했던 첫 번째 방법보다 더 정밀도가 높다.

그 외에도 여러 캐시 서버에 요청을 보내 본 후, 패킷의 왕복 시간을 계산해서 가장 가까운 거리에 있는 캐시 서버를 알아내도록 하는 프로그램을 내장한 페이지를 응답하여 클라이언트가 최적의 캐시 서버를 판단하고 엑세스하도록 하는 방법도 있다.

### 4. 캐시 내용의 갱신 방법에서 성능의 차이가 난다.
캐시 서버의 효율을 결정하는 또 다른 요소는 `캐시 내용의 갱신`여부이다.

기본적으로 캐시라는 것은 한 번 엑세스한 자원을 저장해 두고, 두 번째로 접근하는 경우에는 캐시에서 저장된 값을 가져와 사용하는 것으로 효율을 높일 수 있는 방법이다.  
그렇지만 이는 **최초의 엑세스에는 효과가 없고**, 캐시 저장된 데이터에 접근하는 경우라도 이 내용이 **최신 내용인지 확인하는 절차가 필요**하여 응답 시간에 안좋은 영향을 줄 수도 있다.

이러한 문제점을 개선하기 위해서는 웹 서버에서 데이터를 갱신하는 경우 이를 즉시 캐시 서버에 반영해두는 방법이 필요하다.  
이렇게 되면 첫 번째 엑세스라도 캐시를 이용할 수 있게 되고, 매번 최신 내용인지 확인할 필요도 없게 된다.

다만 동적으로 페이지를 만드는 경우에는 캐시 서버에 이를 저장해두어선 안 된다. 매번 내용이 달라지는 부분과 매번 달라지지 않는 부분을 구분해서 **달라지지 않는 데이터만 캐시에 저장**해야 한다.